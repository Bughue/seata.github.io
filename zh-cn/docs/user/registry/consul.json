{
  "filename": "consul.md",
  "__html": "<h1>Consul 注册中心</h1>\n<p>Consul 是 Seata 组件中重要的注册中心实现</p>\n<p>本文基于 Seata 1.4.2，把 Seata 注册到 Consul 上，以 file 作为配置中心</p>\n<p>Consul 版本建议 1.8+，下文以 Consul 1.11.2 为例</p>\n<h2>预备工作</h2>\n<p>当您准备将 <strong>Seata</strong> 注册到 Consul 之前，请确保已经启动 Consul 服务。如果您尚且不熟悉 Consul 的基本使用的话，\n可先行参考 <a href=\"https://www.consul.io/docs\">Consul 官方文档</a></p>\n<p>如果您只想快速体验，也可以使用以下 docker 命令启动一个 Consul 容器，输入 <a href=\"http://localhost:8500\">http://localhost:8500</a> 访问 Consul 控制台</p>\n<pre><code class=\"language-shell\">docker run -d --name=consul -p 8500:8500 -p 8600:8600/udp consul:1.11.2 agent -dev -client=0.0.0.0 -ui\n</code></pre>\n<h2>快速上手</h2>\n<p>Seata 融合 Consul 注册中心的非常简单，分 Server 端和 Client 端</p>\n<p>Server 端只需要配置“注册中心”</p>\n<p>Client 端则需要增加 Maven 依赖以及配置</p>\n<h3>Server端配置注册中心</h3>\n<p>下载 <a href=\"https://github.com/seata/seata/releases/tag/v1.4.2\">Seata 1.4.2 release</a> 并解压</p>\n<p>在 /conf/registry.conf 中修改对应配置中心，其余<a href=\"https://github.com/seata/seata/blob/develop/script/client/conf/registry.conf\">配置参考</a></p>\n<pre><code>registry {\n  type = &quot;consul&quot;\n\n  consul {\n    # 注册到 Consul 上的集群名称，默认是 default\n    cluster = &quot;default&quot;\n    serverAddr = &quot;127.0.0.1:8500&quot;\n    aclToken = &quot;&quot;\n  }\n}\n</code></pre>\n<p>执行 /bin/seata-server.bat (Windows) 或 /bin/seata-server.sh (Unix) 启动 Seata，服务将运行在本地 8091 端口上</p>\n<p>进入 Consul 控制台，查看 Seata 是否注册成功</p>\n<h3>Client 端增加 Maven 依赖</h3>\n<p><strong>以 SpringBoot 项目为例，在项目 pom.xml 中加入</strong></p>\n<pre><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.seata<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>seata-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>最新版（Seata版本）<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h3>Client端配置</h3>\n<p>在 application.yml 中加入对应的注册中心，其余<a href=\"https://github.com/seata/seata/blob/develop/script/client/spring/application.yml\">配置参考</a></p>\n<pre><code class=\"language-yaml\"><span class=\"hljs-attr\">seata:</span>\n<span class=\"hljs-attr\">  registry:</span>\n<span class=\"hljs-attr\">    consul:</span>\n<span class=\"hljs-attr\">      server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8500</span>\n  <span class=\"hljs-comment\"># 事务分组配置，1.4.2 默认名称为 my_test_tx_group ，1.5版本将改为 default_tx_group</span>\n  <span class=\"hljs-comment\"># 有关事务分组，请参考 http://seata.io/zh-cn/docs/user/txgroup/transaction-group.html</span>\n<span class=\"hljs-attr\">  tx-service-group:</span> <span class=\"hljs-string\">my_test_tx_group</span>\n<span class=\"hljs-attr\">  service:</span>\n    <span class=\"hljs-comment\"># 事务分组与集群映射关系</span>\n<span class=\"hljs-attr\">    vgroup-mapping:</span>\n<span class=\"hljs-attr\">      my_test_tx_group:</span> <span class=\"hljs-string\">default</span>\n</code></pre>\n<p>Client 配置完成后启动应用并稍待片刻，出现以下后日志就可以正式体验 Seata 服务</p>\n<pre><code class=\"language-text\">register TM success. client version:1.4.2, server version:1.4.2,channel:[id: 0xa4675e28, L:/127.0.0.1:8238 - R:/127.0.0.1:8091]\nregister RM success. client version:1.4.2, server version:1.4.2,channel:[id: 0x408192d3, L:/127.0.0.1:8237 - R:/127.0.0.1:8091]\nregister success, cost 94 ms, version:1.4.2,role:RMROLE,channel:[id: 0x408192d3, L:/127.0.0.1:8237 - R:/127.0.0.1:8091]\nregister success, cost 94 ms, version:1.4.2,role:TMROLE,channel:[id: 0xa4675e28, L:/127.0.0.1:8238 - R:/127.0.0.1:8091]\n</code></pre>\n",
  "link": "/zh-cn/docs/user/registry/consul.html",
  "meta": {}
}